{% extends "layouts/base.njk" %}

{% block head %}
  <link rel="stylesheet" href="/css/customer.css">
  <link rel="stylesheet" href="/css/components.css">
{% endblock %}

{% block content %}
<div class="subscribe-container">
  <div class="subscribe-header">
    <h1>Choose Your Plan</h1>
    <p>Get access to exclusive member-only content and features.</p>
  </div>

  {% if canceled %}
    <div class="alert alert-warning">Checkout was canceled. You can try again below.</div>
  {% endif %}

  {% if customer and customer.subscription %}
    <div class="alert alert-info">
      You're currently on the <strong>{{ customer.subscription.plan.name }}</strong> plan.
      <a href="/account/subscription">Manage your subscription</a>
    </div>
  {% endif %}

  <div class="plans-grid">
    {% for plan in plans %}
      <div class="plan-card{% if loop.length == 1 %} plan-featured{% endif %}">
        <div class="plan-name">{{ plan.name }}</div>
        {% if plan.description %}
          <div class="plan-description">{{ plan.description }}</div>
        {% endif %}
        <div class="plan-price">
          <span class="price-amount">${{ plan.price }}</span>
          <span class="price-interval">/{{ plan.interval | replace("ly", "") }}</span>
        </div>
        {% if plan.trial_days > 0 %}
          <div class="plan-trial">{{ plan.trial_days }}-day free trial</div>
        {% endif %}
        {% if plan.features and plan.features.length %}
          <ul class="plan-features">
            {% for feature in plan.features %}
              <li>{{ feature }}</li>
            {% endfor %}
          </ul>
        {% endif %}
        <div class="plan-action">
          {% if customer and customer.subscription and customer.subscription.plan.slug == plan.slug %}
            <button class="btn btn-secondary" disabled>Current Plan</button>
          {% elif customer %}
            <button class="btn btn-primary subscribe-btn" data-plan-id="{{ plan.id }}">
              Subscribe
            </button>
          {% else %}
            <div class="quick-signup-form" id="signup-{{ plan.id }}" style="display: none;">
              <input type="email" placeholder="Email Address" class="signup-email" required>
              <input type="password" placeholder="Password" class="signup-password" required>
              <button class="btn btn-primary quick-subscribe-btn" data-plan-id="{{ plan.id }}">
                Sign Up & Subscribe
              </button>
              <p class="login-link">Already have an account? <a href="/customer/login?redirect=/subscribe">Log in</a></p>
            </div>
            <button class="btn btn-primary show-signup-btn" data-plan-id="{{ plan.id }}">
              Subscribe
            </button>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>

  {% if plans.length == 0 %}
    <div class="no-plans">
      <p>No plans are currently available. Check back soon!</p>
    </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
  <script src="/js/customer-subscribe.js"></script>
{% endblock %}
