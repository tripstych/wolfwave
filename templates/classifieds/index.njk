{# Classified Ad Search Results #}
{% extends "layouts/base.njk" %}

{% block title %}{{ filters.q or "Browse" }} ‚Äî Classifieds{% endblock %}

{% block head %}
{{ super() }}
<style>
  .classifieds-search { max-width: 960px; margin: 0 auto; padding: 2rem 1rem; font-family: system-ui, sans-serif; color: #1a1a2e; }
  .classifieds-search h1 { font-size: 1.75rem; font-weight: 700; margin-bottom: 1.5rem; }
  .search-bar { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .search-bar input[type="text"] { flex: 1; min-width: 200px; padding: 0.6rem 1rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.95rem; }
  .search-bar select { padding: 0.6rem 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; background: #fff; font-size: 0.9rem; }
  .search-bar .btn { padding: 0.6rem 1.25rem; background: #2563eb; color: #fff; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; }
  .search-bar .btn:hover { background: #1d4ed8; }
  .result-count { font-size: 0.875rem; color: #6b7280; margin-bottom: 1.5rem; }
  .listing-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.25rem; }
  .listing-card { border: 1px solid #e5e7eb; border-radius: 10px; overflow: hidden; background: #fff; transition: box-shadow 0.2s; text-decoration: none; display: block; }
  .listing-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.08); }
  .listing-card__image { position: relative; }
  .listing-card__image img { width: 100%; height: 180px; object-fit: cover; }
  .listing-card__body { padding: 1rem; }
  .listing-card__meta { display: flex; justify-content: space-between; font-size: 0.75rem; color: #9ca3af; margin-bottom: 0.5rem; }
  .listing-card__meta .category { background: #eff6ff; color: #2563eb; padding: 2px 8px; border-radius: 4px; font-weight: 500; }
  .listing-card__body h2 { font-size: 1.05rem; margin: 0 0 0.25rem; color: #1a1a2e; }
  .listing-card:hover h2 { color: #2563eb; }
  .price { font-size: 1.15rem; font-weight: 700; color: #059669; margin: 0.25rem 0; }
  .location { font-size: 0.85rem; color: #6b7280; margin: 0.25rem 0; }
  .excerpt { font-size: 0.85rem; color: #4b5563; margin: 0.5rem 0 0; }
  .no-results { grid-column: 1 / -1; text-align: center; padding: 3rem 1rem; color: #6b7280; }
  .post-ad-btn { display: inline-block; margin-bottom: 1rem; padding: 0.6rem 1.25rem; background: #059669; color: #fff; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.9rem; }
  .post-ad-btn:hover { background: #047857; }
</style>
{% endblock %}

{% block content %}
<section class="classifieds-search">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h1>{% if filters.q %}Results for "{{ filters.q }}"{% else %}Browse Listings{% endif %}</h1>
    <a href="/customer/ads/create" class="post-ad-btn">+ Post Ad</a>
  </div>

  <form method="get" action="/classifieds" class="search-bar">
    <input type="text" name="q" value="{{ filters.q }}" placeholder="Search classifieds‚Ä¶">
    <select name="category">
      <option value="">All Categories</option>
      {% for cat in categories %}
      <option value="{{ cat.slug }}" {% if cat.slug == filters.category %}selected{% endif %}>
        {{ cat.name }}
      </option>
      {% endfor %}
    </select>
    <select name="sort">
      <option value="newest" {% if filters.sort == "newest" %}selected{% endif %}>Newest First</option>
      <option value="price_asc" {% if filters.sort == "price_asc" %}selected{% endif %}>Price: Low ‚Üí High</option>
      <option value="price_desc" {% if filters.sort == "price_desc" %}selected{% endif %}>Price: High ‚Üí Low</option>
    </select>
    <button type="submit" class="btn">Search</button>
  </form>

  <p class="result-count">{{ ads.length }} listing{{ "s" if ads.length != 1 }} found</p>

  <div class="listing-grid">
    {% for ad in ads %}
    <a href="/classifieds/{{ ad.slug }}" class="listing-card">
      {% if ad.image %}
      <div class="listing-card__image">
        <img src="{{ ad.image }}" alt="{{ ad.title }}" loading="lazy">
      </div>
      {% endif %}

      <div class="listing-card__body">
        <div class="listing-card__meta">
          <span class="category">{{ ad.category.name }}</span>
          <time datetime="{{ ad.created_at }}">{{ ad.created_at | date("MMM D") }}</time>
        </div>

        <h2>{{ ad.title }}</h2>
        <p class="price">${{ ad.price | round(2) }}</p>
        {% if ad.location %}
        <p class="location">üìç {{ ad.location }}</p>
        {% endif %}
        {% if ad.description %}
        <p class="excerpt">{{ ad.description | truncate(100) }}</p>
        {% endif %}
      </div>
    </a>
    {% else %}
    <div class="no-results">
      <p>No listings match your search. Try broadening your filters.</p>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
