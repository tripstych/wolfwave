import{d as n,q as t,aB as s,ax as e,_ as o,l as r,y as a,o as i,G as l,a0 as c,h as u,v as d,i as m,C as p,E as h,R as f,m as j,A as v,aD as _,g as k,Q as g,e as w,aE as b}from"./chunk.common_D09lIwZG.en.esm.js";import{M as N,A as O}from"./chunk.modal_CMCqeMIe.en.esm.js";function y(n,t){return o(this,void 0,void 0,(function*(){try{const s=yield fetch(n,t);return"ok"in s&&!s.ok?null:function(n){return o(this,void 0,void 0,(function*(){try{return n&&"function"==typeof n.json?yield n.json():null}catch(n){return null}}))}(s)}catch(n){return null}}))}function x(t){var s;const{notify:e}=r(),[i,l]=n(null),[c,u]=n(!1);a((()=>{(()=>{o(this,void 0,void 0,(function*(){const n=yield function(){return o(this,arguments,void 0,(function*(n=location.origin){return y(`${n}/meta.json`)}))}(t);n?l(n):e(new Error("Failed to fetch store metadata")),u(!0)}))})()}),[e,t]);const d=null!==(s=null==i?void 0:i.name)&&void 0!==s?s:"the store";return{loaded:c,storeId:null==i?void 0:i.id,storeMetadata:i,storeName:d}}function L({anchorElement:n,devMode:t,onClose:s,storefrontOrigin:e}){var o;const{trackUserAction:r}=i(),{translate:a}=l(),{loaded:p,storeId:h,storeName:f}=x(e),j=h?`https://shop.app/sid/${h}`:"#";if(c()){const n=a("shopFollowButton.followingModal.title",{store:f}),t=a("shopFollowButton.followingModal.subtitle"),e=a("shopFollowButton.continueGeneric");return u(N,{headerLogo:u(d,{className:"h-4-5 text-purple-primary"}),onDismiss:s,popupDisabled:!0,variant:"follow",visible:p,children:u("div",{className:"m-auto p-6 font-sans",children:[u("div",{className:"relative m-auto pb-4 text-center",children:[u("h2",{className:"mb-2 px-6 text-subtitle text-black",children:n}),u("p",{className:"overflow-hidden text-ellipsis whitespace-pre-line text-body-small text-grayscale-d1",children:t})]}),u("div",{className:"flex justify-center",children:u("button",{className:"w-full rounded-md bg-purple-primary p-3 leading-6 text-white no-underline",onClick:function(){r({userAction:"FOLLOWING_GET_SHOP_APP_CLICK"}),m.open(j,"_self"),s()},type:"button",children:e})})]})})}const v=null!==(o=a("shopFollowButton.followingModal.qrAltText"))&&void 0!==o?o:"";let _=h?`https://shop.app/qr/sid/${h}`:"#";return t&&(_="https://shop.app/qr/sid/59659354134"),u(N,{anchorTo:n,disableMinWidth:!0,hideHeader:!0,onDismiss:s,popupDisabled:!0,variant:"follow",visible:p,children:u("div",{className:"m-auto w-55 p-6 font-sans",children:[u("div",{className:"relative m-auto pb-4 text-center",children:u("p",{className:"overflow-hidden text-ellipsis whitespace-pre-line text-grayscale-d1",children:a("shopFollowButton.followingModal.qrHeader",{store:f})})}),u("div",{className:"m-auto w-37 bg-white forced-color-adjust-none",children:u("img",{src:_,alt:v})}),u("div",{className:"flex justify-center px-0 pb-0 pt-4 text-purple-primary",children:u(d,{className:"h-5"})})]})})}function I({className:n,filled:t}){return u("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20",children:u("path",{fill:t?"currentColor":"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"1.667",d:"m9.14 4.502.86.881.86-.881a3.82 3.82 0 0 1 5.437-.064l.064.064c1.498 1.536 1.518 4.014.062 5.576l-.062.066L10 16.666l-6.36-6.524c-1.52-1.557-1.52-4.083 0-5.641a3.822 3.822 0 0 1 5.5 0Z"})})}const T=({clientId:c,devMode:m=!1,storefrontOrigin:p})=>{const{trackPageImpression:h,trackUserAction:f}=i(),{translate:N}=l(),y=j(),{notify:x}=r(),T=v(null),C=v(null),[M,F]=function({key:o,type:r="localStorage",defaultValue:a}){const i=`signInWithShop:${o}`,[l,c]=n((()=>{const n=e(i,{session:"sessionStorage"===r});if(!n)return a;try{return JSON.parse(n)}catch(n){return a}}));return[l,t((n=>{c(n),s(i,JSON.stringify(n),{session:"sessionStorage"===r})}),[i,r])]}({key:"following",defaultValue:!1}),[S,E]=n(!1),[B,P]=n(!1),W=_(p),[A,D]=n();a((()=>{h({page:M?"COMPONENT_LOADED_FOLLOWING":"COMPONENT_LOADED_NOT_FOLLOWING"})}),[M,h]),a((()=>{if(!T.current||void 0===h||!w())return;const n=new IntersectionObserver((t=>{for(const{isIntersecting:s}of t)s&&(null==n||n.disconnect(),h({page:"FOLLOW_BUTTON_SHOWN_IN_VIEWPORT"}))}));return n.observe(T.current),()=>{n.disconnect()}}),[h]);const G=t((()=>{var n;return M?(h({page:"FOLLOWING_GET_SHOP_APP_CTA"}),E(!0)):(f({userAction:"FOLLOW_ON_SHOP_CLICKED"}),m?F(!0):(P(!0),void(null===(n=C.current)||void 0===n||n.open("user_button_clicked"))))}),[m,M,F,h,f]);const z=k("absolute inset-y-0 -z-10 rounded-max bg-purple-primary",M?"w-9 animate-follow":"w-full group-hover_bg-purple-d0"),H=k("group relative inline-flex h-9 items-center rounded-max bg-transparent",M&&"gap-x-1-5"),R=k("cursor-pointer whitespace-nowrap pr-3 font-sans text-button-large transition-colors",M?"text-black":"text-white"),q=M?"shopFollowButton.following":"shopFollowButton.follow",{authorizeUrl:$}=g({clientId:c,error:A,flow:"follow",proxy:!0,redirectType:"iframe",responseType:"code"}),U=B?u(O,{onClose:()=>E(!1),onComplete:function(n){return o(this,arguments,void 0,(function*({loggedIn:n,shouldFinalizeLogin:t,email:s}){n&&t&&(yield b(W,(n=>{x(new Error(n))}))),y("completed",{loggedIn:n,email:s}),F(!0),P(!1),E(!1)}))},onError:function({code:n,email:t,message:s}){var e;y("error",{code:n,email:t,message:s}),"retriable_server_error"===n&&(A===n&&(null===(e=C.current)||void 0===e||e.reload()),D("retriable_server_error"))},onLoaded:function(){var n;!M&&B&&(null===(n=C.current)||void 0===n||n.open("user_button_clicked"))},proxy:!0,ref:C,src:$,storefrontOrigin:W,variant:"follow"}):null,K=M&&S&&W?u(L,{anchorElement:T,devMode:m,onClose:()=>E(!1),storefrontOrigin:W}):null;return u("div",{className:"relative z-0",children:[u("button",{className:H,onClick:G,type:"button",ref:T,children:[u("div",{className:z}),u("div",{className:"px-2 text-white",children:u(I,{className:"size-5",filled:M})}),u("span",{className:R,children:N(q,{shop:u(d,{className:"relative inline-block h-4 w-auto"})})})]}),U,K]})},C=n=>o(void 0,void 0,void 0,(function*(){return yield {shopFollowButton:{continueGeneric:"Continue",follow:"Follow on {shop}",following:"Following on {shop}",followingModal:{title:"Visit {store} on Shop",subtitle:"Everything you need to shop, track, and payâ€”all in one place.",qrHeader:"Scan to visit {store} on the Shop app",qrAltText:"Shop app QR code"}}}}));p((n=>{var{devMode:t,element:s}=n,e=h(n,["devMode","element"]);return u(f,{devMode:t,element:s,monorailProps:{analyticsContext:"loginWithShopFollow",flow:"follow"},featureName:"ShopFollowButton",getFeatureDictionary:C,children:u(T,Object.assign({},e,{devMode:t}))})}),{name:"shop-follow-button",props:{clientId:"string",devMode:"boolean",storefrontOrigin:"string"},shadow:"open"});
//# sourceMappingURL=client.shop-follow-button__XKi-CjE.en.esm.js.map
