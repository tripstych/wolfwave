class FacetsToggle{constructor(){this.container=document.getElementById("Facet-Drawer");let button=document.getElementById("Facets-Toggle");button&&button.addEventListener("click",e=>{e.preventDefault(),document.getElementsByTagName("body")[0].classList.toggle("open-cc"),this.container.classList.toggle("active")}),setTimeout(function(){window.dispatchEvent(new Event("resize.resize-select"))},10)}}class FacetFiltersForm extends HTMLElement{constructor(){super(),this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.debouncedOnSubmit=debounce(event=>{this.onSubmitHandler(event)},500),this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this))}static setListeners(){const onHistoryChange=event=>{const searchParams=event.state?event.state.searchParams:FacetFiltersForm.searchParamsInitial;searchParams!==FacetFiltersForm.searchParamsPrev&&FacetFiltersForm.renderPage(searchParams,null,!1)};window.addEventListener("popstate",onHistoryChange)}static toggleActiveFacets(disable=!0){document.querySelectorAll(".js-facet-remove").forEach(element=>{element.classList.toggle("disabled",disable)})}static renderPage(searchParams,event,updateURLHash=!0){FacetFiltersForm.searchParamsPrev=searchParams;const sections=FacetFiltersForm.getSections(),container=document.getElementsByClassName("thb-filter-count");document.getElementById("ProductGridContainer").querySelector(".collection").classList.add("loading");for(var item of container)item.classList.add("loading");sections.forEach(section=>{const url=`${window.location.pathname}?section_id=${section.section}&${searchParams}`,filterDataUrl=element=>element.url===url;FacetFiltersForm.filterData.some(filterDataUrl)?FacetFiltersForm.renderSectionFromCache(filterDataUrl,event):FacetFiltersForm.renderSectionFromFetch(url,event)}),updateURLHash&&FacetFiltersForm.updateURLHash(searchParams)}static renderSectionFromFetch(url,event){fetch(url).then(response=>response.text()).then(responseText=>{const html=responseText;FacetFiltersForm.filterData=[...FacetFiltersForm.filterData,{html,url}],FacetFiltersForm.renderFilters(html,event),FacetFiltersForm.renderProductGridContainer(html),FacetFiltersForm.renderProductCount(html),new FacetsToggle})}static renderSectionFromCache(filterDataUrl,event){const html=FacetFiltersForm.filterData.find(filterDataUrl).html;FacetFiltersForm.renderFilters(html,event),FacetFiltersForm.renderProductGridContainer(html),FacetFiltersForm.renderProductCount(html),new FacetsToggle}static renderProductGridContainer(html){document.getElementById("ProductGridContainer").innerHTML=new DOMParser().parseFromString(html,"text/html").getElementById("ProductGridContainer").innerHTML;let top=document.getElementById("ProductGridContainer").getBoundingClientRect().top+document.documentElement.scrollTop-parseInt(getComputedStyle(document.documentElement).getPropertyValue("--header-height"),10)-30;window.scrollTo({top,left:0,behavior:"smooth"})}static renderProductCount(html){const countHtml=new DOMParser().parseFromString(html,"text/html").getElementById("ProductCount"),container=document.getElementsByClassName("thb-filter-count");if(countHtml)for(var item of container)item.innerHTML=countHtml.innerHTML,item.classList.remove("loading")}static renderFilters(html,event){const parsedHTML=new DOMParser().parseFromString(html,"text/html"),facetDetailsElements=parsedHTML.querySelectorAll("#FacetFiltersForm collapsible-row, #FacetFiltersFormMobile collapsible-row"),matchesIndex=element=>{const jsFilter=event?event.target.closest("collapsible-row"):void 0;return jsFilter?element.dataset.index===jsFilter.dataset.index:!1},facetsToRender=Array.from(facetDetailsElements).filter(element=>!matchesIndex(element)),countsToRender=Array.from(facetDetailsElements).find(matchesIndex);facetsToRender.forEach(element=>{document.querySelector(`collapsible-row[data-index="${element.dataset.index}"]`).innerHTML=element.innerHTML}),FacetFiltersForm.renderActiveFacets(parsedHTML),FacetFiltersForm.renderAdditionalElements(parsedHTML),new FacetsToggle,countsToRender&&FacetFiltersForm.renderCounts(countsToRender,event.target.closest("collapsible-row"))}static renderActiveFacets(html){[".active-facets"].forEach(selector=>{const activeFacetsElement=html.querySelector(selector);activeFacetsElement&&(document.querySelector(selector).innerHTML=activeFacetsElement.innerHTML)}),FacetFiltersForm.toggleActiveFacets(!1)}static renderAdditionalElements(html){[".mobile-filter-count"].forEach(selector=>{html.querySelector(selector)&&(document.querySelector(selector).innerHTML=html.querySelector(selector).innerHTML)})}static renderCounts(source,target){const targetElement=target.querySelector(".facets__selected");source.querySelector(".facets__selected")&&targetElement&&(target.querySelector(".facets__selected").outerHTML=source.querySelector(".facets__selected").outerHTML)}static updateURLHash(searchParams){history.pushState({searchParams},"",`${window.location.pathname}${searchParams&&"?".concat(searchParams)}`)}static getSections(){return[{section:document.getElementById("product-grid").dataset.id}]}onSubmitHandler(event){event.preventDefault();const formData=new FormData(event.target.closest("form")),searchParams=new URLSearchParams(formData);searchParams.get("filter.v.price.gte")==="0.00"&&searchParams.delete("filter.v.price.gte"),document.querySelector(".price_slider")&&searchParams.get("filter.v.price.lte")===parseFloat(document.querySelector(".price_slider").dataset.max).toFixed(2)&&searchParams.delete("filter.v.price.lte"),FacetFiltersForm.renderPage(searchParams.toString(),event)}onActiveFilterClick(event){event.preventDefault(),FacetFiltersForm.toggleActiveFacets();const url=event.currentTarget.href.indexOf("?")==-1?"":event.currentTarget.href.slice(event.currentTarget.href.indexOf("?")+1);FacetFiltersForm.renderPage(url)}}FacetFiltersForm.filterData=[],FacetFiltersForm.searchParamsInitial=window.location.search.slice(1),FacetFiltersForm.searchParamsPrev=window.location.search.slice(1),customElements.define("facet-filters-form",FacetFiltersForm),FacetFiltersForm.setListeners();class FacetRemove extends HTMLElement{constructor(){super(),this.querySelectorAll("a").forEach(item=>{item.addEventListener("click",event=>{event.preventDefault(),(this.closest("facet-filters-form")||document.querySelector("facet-filters-form")).onActiveFilterClick(event)})})}}customElements.define("facet-remove",FacetRemove);class PriceSlider extends HTMLElement{constructor(){super()}connectedCallback(){let slider=this.querySelector(".price_slider"),amounts=this.querySelector(".price_slider_amount"),args={start:[parseFloat(slider.dataset.minValue||0),parseFloat(slider.dataset.maxValue||slider.dataset.max)],connect:!0,step:10,direction:document.dir,range:{min:0,max:parseFloat(slider.dataset.max)}},event=new CustomEvent("input"),form=this.closest("facet-filters-form")||document.querySelector("facet-filters-form");slider.classList.contains("noUi-target")&&slider.noUiSlider.destroy(),noUiSlider.create(slider,args),slider.noUiSlider.on("update",function(values){amounts.querySelector(".field__input_min").value=values[0],amounts.querySelector(".field__input_max").value=values[1]}),slider.noUiSlider.on("change",function(values){form.querySelector("form").dispatchEvent(event)})}}customElements.define("price-slider",PriceSlider),window.addEventListener("load",()=>{new FacetsToggle});
//# sourceMappingURL=/cdn/shop/t/15/assets/facets.js.map?v=52461161384891598971763113117
